{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the StressWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "createdAt"
      ]
    },
    "StressAssessment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StressAssessment",
      "type": "object",
      "description": "Represents a single stress assessment performed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StressAssessment entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N StressAssessment)"
        },
        "sentimentInput": {
          "type": "string",
          "description": "User's input about their feelings and problems."
        },
        "questionnaireResponses": {
          "type": "string",
          "description": "JSON string containing the user's responses to the questionnaire.  Structure is defined by the questionnaire itself."
        },
        "stressLevel": {
          "type": "number",
          "description": "AI-detected stress level (e.g., on a scale of 1-10)."
        },
        "keyStressors": {
          "type": "string",
          "description": "AI-identified key stressors for the user."
        },
        "advice": {
          "type": "string",
          "description": "Personalized advice generated by the AI."
        },
        "assessmentDate": {
          "type": "string",
          "description": "Date and time when the assessment was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "sentimentInput",
        "questionnaireResponses",
        "stressLevel",
        "keyStressors",
        "advice",
        "assessmentDate"
      ]
    },
    "Therapist": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Therapist",
      "type": "object",
      "description": "Represents a therapist providing contact information for users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Therapist entity."
        },
        "name": {
          "type": "string",
          "description": "Therapist's name."
        },
        "specialization": {
          "type": "string",
          "description": "Therapist's area of specialization (e.g., anxiety, depression)."
        },
        "contactNumber": {
          "type": "string",
          "description": "Therapist's contact phone number."
        },
        "email": {
          "type": "string",
          "description": "Therapist's email address.",
          "format": "email"
        },
        "address": {
          "type": "string",
          "description": "Therapist's office address."
        },
        "city": {
          "type": "string",
          "description": "City where the therapist is located."
        },
        "state": {
          "type": "string",
          "description": "State where the therapist is located (India)."
        }
      },
      "required": [
        "id",
        "name",
        "specialization",
        "contactNumber",
        "email",
        "address",
        "city",
        "state"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stressAssessments/{assessmentId}",
        "definition": {
          "entityName": "StressAssessment",
          "schema": {
            "$ref": "#/backend/entities/StressAssessment"
          },
          "description": "Stores stress assessment data for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "assessmentId",
              "description": "The unique identifier for the stress assessment."
            }
          ]
        }
      },
      {
        "path": "/therapists/{therapistId}",
        "definition": {
          "entityName": "Therapist",
          "schema": {
            "$ref": "#/backend/entities/Therapist"
          },
          "description": "Stores therapist contact information for users to access.",
          "params": [
            {
              "name": "therapistId",
              "description": "The unique identifier for the therapist."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the StressWise application's core features, focusing on user privacy, data security, and efficient querying.  It incorporates the principles of Authorization Independence and Structural Segregation to create a robust and maintainable system.\n\n*   **Users Collection:** Stores user profiles.  Access is restricted to the user themselves.\n*   **StressAssessments Collection (User-Owned):** Each user has their own collection of stress assessments. This allows for easy retrieval of a user's assessment history and supports the progress tracking feature.  The `userId` field within each `StressAssessment` document is redundant but crucial for authorization independence. It allows rules to validate ownership without needing to perform a `get()` on the parent `User` document.\n*   **Therapists Collection:** Stores therapist contact information.  This data is considered public and accessible to all users.\n\n**Authorization Independence:**\n\nAuthorization independence is achieved by denormalizing the `userId` into the `StressAssessments` collection. This eliminates the need for security rules to perform `get()` operations to verify user ownership, enabling atomic operations (transactions and batches) and simplifying the rules.\n\n**QAPs (Rules are not Filters):**\n\nThe structure supports secure `list` operations by:\n\n*   **Path-Based Ownership for Assessments:** Placing assessments in user-specific subcollections (`/users/{userId}/stressAssessments/{assessmentId}`) ensures that listing assessments is always scoped to a specific user.  Rules can easily enforce that only the authenticated user can list their own assessments.\n*   **Public Therapists Collection:** The `/therapists` collection is designed for public access. Security rules can allow unauthenticated reads, making it easy to display therapist information without complex authorization logic.\n\nThis design provides a clear separation of concerns, simplifies security rules, and enables efficient data access patterns for the StressWise application."
  }
}